<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.find.doongji.search.repository.SearchHistoryRepository">

    <!-- Insert a search history record -->
    <insert id="insertSearchHistory" parameterType="com.find.doongji.search.payload.request.SearchHistoryRequest">
        INSERT INTO search_history (username, query, created_at)
        VALUES (#{username}, #{query}, NOW());
    </insert>

    <!-- Get search history by username -->
    <select id="getSearchHistoryByUsername" parameterType="string" resultType="com.find.doongji.search.payload.response.SearchHistoryResponse">
        SELECT id, username, query, created_at
        FROM search_history
        WHERE username = #{username}
        ORDER BY created_at DESC;
    </select>

    <!-- Delete search history by ID -->
    <delete id="deleteSearchHistoryById" parameterType="long">
        DELETE FROM search_history
        WHERE id = #{id};
    </delete>

    <!-- Find duplicate search history -->
    <select id="findDuplicateSearchHistory" parameterType="map" resultType="com.find.doongji.search.payload.response.SearchHistoryResponse">
        SELECT id, username, query, created_at
        FROM search_history
        WHERE username = #{username}
          AND query = #{query}
            LIMIT 1;
    </select>
</mapper>
