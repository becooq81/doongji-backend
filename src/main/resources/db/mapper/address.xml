<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.find.doongji.address.repository.AddressRepository">

    <select id="checkIfMappingTableExists" resultType="int">
        SELECT CASE
        WHEN EXISTS (SELECT 1 FROM address_mapping LIMIT 1) THEN 1
        ELSE 0
        END;
    </select>

    <insert id="bulkInsertAddressMapping" parameterType="list">
        INSERT INTO address_mapping (old_address, road_address, umd_nm, jibun, apt_seq, danji_id, bjd_code, apt_nm,
        road_nm, road_nm_bonbun, road_nm_bubun)
        VALUES
        <foreach collection="list" item="mapping" separator=",">
            (#{mapping.oldAddress}, #{mapping.roadAddress}, #{mapping.umdNm}, #{mapping.jibun}, #{mapping.aptSeq},
            #{mapping.danjiId}, #{mapping.bjdCode}, #{mapping.aptNm}, #{mapping.roadNm}, #{mapping.roadNmBonbun},
            #{mapping.roadNmBubun})
        </foreach>
    </insert>

    <insert id="insertAddressMapping" parameterType="com.find.doongji.address.payload.request.AddressMapping">
        INSERT INTO address_mapping (
        old_address, umd_nm, jibun, apt_seq, danji_id, bjd_code, road_nm, road_nm_bonbun, road_nm_bubun, road_address,
        apt_nm
        )
        VALUES (
        #{oldAddress}, #{umdNm}, #{jibun}, #{aptSeq}, #{danjiId}, #{bjdCode}, #{roadNm}, #{roadNmBonbun},
        #{roadNmBubun}, #{roadAddress}, #{aptNm}
        )
    </insert>

    <select id="selectAddressMappingByDanjiId" parameterType="long"
            resultType="com.find.doongji.address.payload.response.AddressMappingResponse">
        select * from address_mapping
        where danji_id = #{danjiId}
        limit 1;
    </select>

    <select id="selectAddressMappingByRoadAddress" parameterType="String"
            resultType="com.find.doongji.address.payload.response.AddressMappingResponse">
        SELECT * FROM address_mapping
        WHERE road_address = #{roadAddress}
    </select>

    <select id="selectAddressMappingByJibunAddress" parameterType="String"
            resultType="com.find.doongji.address.payload.response.AddressMappingResponse">
        SELECT * FROM address_mapping
        WHERE jibun_address like CONCAT('%', #{jibunAddress}, '%')
    </select>

    <select id="selectAddressMappingByDanjiIdList" parameterType="list" resultType="com.find.doongji.address.payload.response.AddressMappingResponse">
        SELECT *
        FROM address_mapping
        WHERE danji_id IN
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="selectAddressMappingByAptSeq" parameterType="String"
            resultType="com.find.doongji.address.payload.response.AddressMappingResponse">
        SELECT * FROM address_mapping
        WHERE apt_seq = #{aptSeq}
    </select>
</mapper>